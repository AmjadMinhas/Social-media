import{r as d,m as K,G as F,q as Q,f as R,g as X,H as Y,o,a as e,n as c,c as l,t as n,w as M,ag as I,v as A,F as w,e as k,b as x,j as Z,k as ee,O as f,T as D}from"./app-db66d61d.js";import{_ as te}from"./App-3956ecd8.js";import{P as se}from"./Pagination-274271d8.js";import"./Sidebar-52b221b8.js";import"./Menu-b889f12a.js";import"./Modal-a824fd5c.js";import"./ProfileModal-26295007.js";import"./FormInput-44af5dd7.js";import"./FormPhoneInput-dd458330.js";/* empty css                      */import"./FormSelect-299ed3fd.js";import"./index-7cc47353.js";import"./hidden-be603183.js";import"./use-text-value-dc32201d.js";import"./transition-59378dc4.js";import"./micro-task-89dcd6af.js";import"./tabs-8bf78ca9.js";import"./LangToggle-522c5268.js";import"./OrganizationModal-7997fd80.js";import"./index-f104af55.js";import"./MobileSidebar-fde650c3.js";/* empty css              */import"./pusher-2d476617.js";import"./_plugin-vue_export-helper-c27b6911.js";const ae={class:"md:flex md:flex-grow md:overflow-hidden"},oe={class:"p-4 border-b bg-white"},le={class:"flex items-center justify-between mb-3"},re=["disabled"],ne={key:0},ie={key:1},de={class:"grid grid-cols-4 gap-2 mb-3"},ue={class:"text-center p-2 bg-green-50 rounded"},ce={class:"font-bold text-green-600"},pe={class:"text-center p-2 bg-blue-50 rounded"},ve={class:"font-bold text-blue-600"},me={class:"text-center p-2 bg-purple-50 rounded"},ge={class:"font-bold text-purple-600"},xe={class:"text-center p-2 bg-sky-50 rounded"},fe={class:"font-bold text-sky-600"},be={class:"flex-1 overflow-y-auto"},_e={key:0},ye=["onClick"],he={class:"flex items-center justify-between"},we={class:"flex-1"},ke={class:"font-medium"},Se={class:"text-xs text-gray-500 mt-1"},Ce={key:0},je={key:1},Me={class:"flex flex-col items-end"},Pe={class:"flex gap-1 mb-1"},Te={class:"text-xs text-gray-400"},Be={key:1,class:"p-4 text-center text-gray-500"},Oe={key:2,class:"p-4"},Ve={key:0,class:"p-4 bg-white border-b flex items-center justify-between"},Ue={class:"flex items-center space-x-3"},Ne={class:"font-semibold"},Fe={class:"text-xs text-gray-500"},Ie={key:0},Ae={class:"flex items-center gap-2 mb-1"},De={class:"text-xs opacity-70"},Ee={key:1,class:"text-center text-gray-500 mt-8"},He={key:2,class:"p-4 bg-white border-t"},qe=["value"],ze=["disabled"],Le={key:0},$e={key:1},Je={key:3,class:"flex-1 flex items-center justify-center text-gray-500"},xt={__name:"Index",props:{contacts:{type:Object,default:()=>({data:[],links:[],current_page:1,last_page:1,per_page:20,total:0})},messages:{type:Object,default:null},selectedContact:{type:Object,default:null},filters:{type:Object,default:()=>({})},stats:{type:Object,default:()=>({whatsapp:0,facebook:0,instagram:0,twitter:0,total:0})},connectedPlatforms:{type:Array,default:()=>[]}},setup(E){var U,N;const u=E,r=d(u.selectedContact||null),b=d(u.messages||null),i=d(u.contacts||{data:[],links:[],current_page:1,last_page:1,per_page:20,total:0}),_=d(u.stats||{whatsapp:0,facebook:0,instagram:0,twitter:0,total:0}),p=d(((U=u.filters)==null?void 0:U.search)||""),v=d(((N=u.filters)==null?void 0:N.platform)||""),m=d(""),g=d(""),y=d(!1),h=d(!1),S=d(null),H=K(()=>i.value?{current_page:i.value.current_page||1,last_page:i.value.last_page||1,total:i.value.total||0}:{current_page:1,last_page:1,total:0}),C=a=>{if(!a||!a.chats)return[];const t=new Set;return a.chats.forEach(T=>{T.platform&&t.add(T.platform)}),Array.from(t)},P=a=>({whatsapp:"bg-green-100 text-green-700",facebook:"bg-blue-100 text-blue-700",instagram:"bg-purple-100 text-purple-700",twitter:"bg-sky-100 text-sky-700"})[a]||"bg-gray-100 text-gray-700",B=a=>{if(!a||!a.metadata)return"";try{const t=JSON.parse(a.metadata);return t.text&&t.text.body?t.text.body.substring(0,50):"Media message"}catch{return""}},q=a=>{if(!a||!a.metadata)return"";try{const t=JSON.parse(a.metadata);return t.text&&t.text.body?t.text.body:"Media message"}catch{return""}},O=a=>a?new Date(a).toLocaleString():"",z=a=>{r.value=a,f.get(`/social-inbox/${a.uuid}`,{platform:v.value,search:p.value},{preserveState:!0,preserveScroll:!0})},L=()=>{r.value=null,f.get("/social-inbox",{platform:v.value,search:p.value})},$=()=>{f.get("/social-inbox",{platform:v.value,search:p.value},{preserveState:!0})},J=()=>{f.get("/social-inbox",{platform:v.value,search:p.value},{preserveState:!0})},W=async()=>{if(!(!m.value||!g.value)){y.value=!0;try{D({contact_id:r.value.id,platform:m.value,message:g.value}).post("/social-inbox/send",{preserveScroll:!0,onSuccess:()=>{g.value="",f.reload({only:["messages"]})},onFinish:()=>{y.value=!1}})}catch(a){console.error("Error sending message:",a),y.value=!1}}},G=async()=>{h.value=!0;try{D({}).post("/social-inbox/sync",{preserveScroll:!0,onSuccess:()=>{f.reload()},onFinish:()=>{h.value=!1}})}catch(a){console.error("Error syncing messages:",a),h.value=!1}},V=()=>{Y(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})};return F(()=>u.messages,a=>{b.value=a,V()}),F(()=>u.selectedContact,a=>{if(r.value=a,a){const t=C(a);t.length>0&&(m.value=t[0])}}),Q(()=>{console.log("UnifiedSocialInbox mounted",{contacts:i.value,stats:_.value,selectedContact:r.value}),V()}),(a,t)=>(o(),R(te,null,{default:X(T=>[e("div",ae,[e("div",{class:c(["md:w-[30%] md:flex flex-col h-full bg-white border-r border-l",r.value?"hidden md:hidden":""])},[e("div",oe,[e("div",le,[t[4]||(t[4]=e("h2",{class:"text-lg font-semibold"},"Unified Social Inbox",-1)),e("button",{onClick:G,disabled:h.value,class:"px-3 py-1.5 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 disabled:opacity-50"},[h.value?(o(),l("span",ie,"Syncing...")):(o(),l("span",ne,"Sync"))],8,re)]),e("div",de,[e("div",ue,[t[5]||(t[5]=e("div",{class:"text-xs text-gray-600"},"WhatsApp",-1)),e("div",ce,n(_.value.whatsapp||0),1)]),e("div",pe,[t[6]||(t[6]=e("div",{class:"text-xs text-gray-600"},"Facebook",-1)),e("div",ve,n(_.value.facebook||0),1)]),e("div",me,[t[7]||(t[7]=e("div",{class:"text-xs text-gray-600"},"Instagram",-1)),e("div",ge,n(_.value.instagram||0),1)]),e("div",xe,[t[8]||(t[8]=e("div",{class:"text-xs text-gray-600"},"Twitter",-1)),e("div",fe,n(_.value.twitter||0),1)])]),M(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),onChange:$,class:"w-full px-3 py-2 border rounded-md text-sm mb-3"},t[9]||(t[9]=[e("option",{value:""},"All Platforms",-1),e("option",{value:"whatsapp"},"WhatsApp",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"instagram"},"Instagram",-1),e("option",{value:"twitter"},"Twitter",-1)]),544),[[I,v.value]]),M(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),onInput:J,placeholder:"Search contacts...",class:"w-full px-3 py-2 border rounded-md text-sm"},null,544),[[A,p.value]])]),e("div",be,[i.value&&i.value.data&&i.value.data.length>0?(o(),l("div",_e,[(o(!0),l(w,null,k(i.value.data,s=>(o(),l("div",{key:s.id,onClick:j=>z(s),class:c(["p-3 border-b hover:bg-gray-50 cursor-pointer",r.value&&r.value.id===s.id?"bg-blue-50":""])},[e("div",he,[e("div",we,[e("div",ke,n(s.full_name||s.first_name+" "+s.last_name||"Unknown"),1),e("div",Se,[s.last_chat?(o(),l("span",Ce,n(B(s.last_chat)),1)):s.lastChat?(o(),l("span",je,n(B(s.lastChat)),1)):x("",!0)])]),e("div",Me,[e("div",Pe,[(o(!0),l(w,null,k(C(s),j=>(o(),l("span",{key:j,class:c([P(j),"text-xs px-2 py-0.5 rounded"])},n(j),3))),128))]),e("div",Te,n(s.latest_chat_created_at?O(s.latest_chat_created_at):""),1)])])],10,ye))),128))])):(o(),l("div",Be,t[10]||(t[10]=[e("p",{class:"mb-2"},"No contacts found",-1),e("p",{class:"text-xs"},"Connect social accounts and sync messages to get started",-1)]))),i.value&&i.value.last_page>1?(o(),l("div",Oe,[Z(se,{pagination:H.value},null,8,["pagination"])])):x("",!0)])],2),e("div",{class:c(["min-w-0 bg-cover flex flex-col chat-bg",r.value?"h-screen md:w-[70%]":"md:h-screen md:w-[70%]"])},[r.value?(o(),l("div",Ve,[e("div",Ue,[e("button",{onClick:L,class:"md:hidden p-2 hover:bg-gray-100 rounded"},t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 18l-6-6l6-6"})],-1)])),e("div",null,[e("div",Ne,n(r.value.full_name||"Unknown"),1),e("div",Fe,[(o(!0),l(w,null,k(C(r.value),s=>(o(),l("span",{key:s,class:c([P(s),"text-xs px-2 py-0.5 rounded mr-1"])},n(s),3))),128))])])])])):x("",!0),r.value&&b.value?(o(),l("div",{key:1,class:"flex-1 overflow-y-auto p-4",ref_key:"messagesContainer",ref:S},[b.value.data&&b.value.data.length>0?(o(),l("div",Ie,[(o(!0),l(w,null,k(b.value.data,s=>(o(),l("div",{key:s.id,class:"mb-4"},[e("div",{class:c(["flex",s.type==="outbound"?"justify-end":"justify-start"])},[e("div",{class:c(["max-w-[70%] rounded-lg p-3",s.type==="outbound"?"bg-blue-500 text-white":"bg-white border"])},[e("div",Ae,[e("span",{class:c([P(s.platform),"text-xs px-2 py-0.5 rounded"])},n(s.platform),3),e("span",De,n(O(s.created_at)),1)]),e("div",null,n(q(s)),1)],2)],2)]))),128))])):(o(),l("div",Ee," No messages yet "))],512)):x("",!0),r.value?(o(),l("div",He,[e("form",{onSubmit:ee(W,["prevent"]),class:"flex gap-2"},[M(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>m.value=s),class:"px-3 py-2 border rounded-md text-sm",required:""},[t[12]||(t[12]=e("option",{value:""},"Select Platform",-1)),(o(!0),l(w,null,k(C(r.value),s=>(o(),l("option",{key:s,value:s},n(s),9,qe))),128))],512),[[I,m.value]]),M(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=s=>g.value=s),placeholder:"Type a message...",class:"flex-1 px-3 py-2 border rounded-md",required:""},null,512),[[A,g.value]]),e("button",{type:"submit",disabled:!m.value||!g.value||y.value,class:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50"},[y.value?(o(),l("span",$e,"Sending...")):(o(),l("span",Le,"Send"))],8,ze)],32)])):x("",!0),r.value?x("",!0):(o(),l("div",Je,t[13]||(t[13]=[e("div",{class:"text-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",class:"mx-auto mb-4 opacity-50"},[e("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})]),e("p",null,"Select a contact to view messages")],-1)])))],2)])]),_:1}))}};export{xt as default};
