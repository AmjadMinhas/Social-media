import{T as x,r as k,K as y,m as S,f as F,g as P,c as a,a as t,t as n,F as w,e as f,o as s,j as C,u as g,af as T,n as _}from"./app-61c8a8d7.js";import{_ as $}from"./App-9b2e8f80.js";import"./Sidebar-7b294ca0.js";import"./Menu-223947ef.js";import"./Modal-bea850fb.js";import"./ProfileModal-c1047aba.js";import"./FormInput-7ffa2b04.js";import"./FormPhoneInput-68a9fc40.js";/* empty css                      */import"./FormSelect-74a1738b.js";import"./index-fd5d1af0.js";import"./hidden-58bd081b.js";import"./use-text-value-5ff615c3.js";import"./transition-48c3dae0.js";import"./micro-task-89dcd6af.js";import"./tabs-61ea580c.js";import"./LangToggle-5bd74dbc.js";import"./OrganizationModal-e60d3dbb.js";import"./index-a2d64f9d.js";import"./MobileSidebar-c0dce6fc.js";/* empty css              */import"./pusher-794d5086.js";const N={class:"py-6 px-4 md:px-6 lg:px-8"},O={class:"max-w-4xl mx-auto"},M={class:"bg-white rounded-lg shadow-md p-8"},j={class:"text-2xl font-bold text-gray-900 mb-2"},B={class:"text-gray-600 mb-6"},E={class:"space-y-4"},L=["onClick"],A={class:"flex items-center space-x-4"},q=["src","alt"],J={key:1,class:"w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center text-white text-2xl font-bold"},R={class:"flex-1"},X={class:"text-lg font-semibold"},z={class:"text-sm text-gray-500"},D={key:2,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},H={key:3,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",class:"text-gray-400"},I={class:"mt-6 text-center"},K={href:"/social-accounts",class:"text-blue-600 hover:text-blue-800"},V={key:1,class:"min-h-screen bg-gray-50 py-6 px-4"},G={class:"max-w-4xl mx-auto"},W={class:"bg-white rounded-lg shadow-md p-8"},Z={class:"text-2xl font-bold text-gray-900 mb-2"},Q={class:"text-gray-600 mb-6"},U={class:"space-y-4"},Y=["onClick"],ee={class:"flex items-center space-x-4"},te=["src","alt"],oe={key:1,class:"w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center text-white text-2xl font-bold"},se={class:"flex-1"},ae={class:"text-lg font-semibold"},ne={class:"text-sm text-gray-500"},ie={key:2,class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"},re={key:3,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",class:"text-gray-400"},ce={class:"mt-6 text-center"},Oe={__name:"SelectFacebookPage",props:{title:String,pages:Array,isPopup:Boolean},setup(l){const p=l,u=x({page_id:null}),i=k(!1),b=y(),h=S(()=>{var o;return b.props.csrf_token||((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}),m=async o=>{var r;if(!i.value)if(console.log("ðŸ”µ SelectFacebookPage: Starting page selection",{pageId:o,isPopup:p.isPopup,hasOpener:!!window.opener,pagesCount:(r=p.pages)==null?void 0:r.length,csrfToken:h.value?"EXISTS":"MISSING"}),i.value=!0,u.page_id=o,p.isPopup&&window.opener)try{console.log("ðŸ”µ SelectFacebookPage: Sending fetch request",{url:"/auth/facebook/save-page",pageId:o,hasCsrfToken:!!h.value});const e=await fetch("/auth/facebook/save-page",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":h.value,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({page_id:o})});console.log("ðŸ”µ SelectFacebookPage: Response received",{status:e.status,statusText:e.statusText,contentType:e.headers.get("content-type"),ok:e.ok});const d=e.headers.get("content-type");let c;if(d&&d.includes("application/json"))c=await e.json(),console.log("ðŸ”µ SelectFacebookPage: JSON data received",c);else{const v=await e.text();throw console.error("âŒ SelectFacebookPage: Non-JSON response received",{contentType:d,status:e.status,textPreview:v.substring(0,500)}),new Error("Server returned an error page instead of JSON. Please try again.")}e.ok&&c.success!==!1?(console.log("âœ… SelectFacebookPage: Success! Sending message to parent",{message:c.message,hasOpener:!!window.opener}),window.opener&&(window.opener.postMessage({type:"oauth_success",message:c.message||"Facebook page connected successfully!"},window.location.origin),console.log("âœ… SelectFacebookPage: Message sent, closing popup")),setTimeout(()=>{window.closed||window.close()},100)):(console.error("âŒ SelectFacebookPage: Error response",{success:c.success,message:c.message,status:e.status}),window.opener&&window.opener.postMessage({type:"oauth_error",message:c.message||"Failed to connect Facebook page"},window.location.origin),setTimeout(()=>{window.closed||window.close()},100))}catch(e){console.error("âŒ SelectFacebookPage: Exception caught",{error:e.message,stack:e.stack,hasOpener:!!window.opener}),window.opener&&(window.opener.postMessage({type:"oauth_error",message:"Failed to connect Facebook page: "+e.message},window.location.origin),setTimeout(()=>{window.closed||window.close()},100))}finally{i.value=!1,console.log("ðŸ”µ SelectFacebookPage: Process completed")}else u.post("/auth/facebook/save-page",{onSuccess:()=>{},onError:()=>{i.value=!1},onFinish:()=>{i.value=!1}})};return(o,r)=>l.isPopup?(s(),a("div",V,[t("div",G,[t("div",W,[t("h1",Z,n(o.$t("Select Facebook Page")),1),t("p",Q,n(o.$t("Choose which Facebook page you want to connect for posting")),1),t("div",U,[(s(!0),a(w,null,f(l.pages,e=>(s(),a("div",{key:e.id,class:_(["border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 transition cursor-pointer",{"opacity-50 cursor-not-allowed":i.value}]),onClick:d=>!i.value&&m(e.id)},[t("div",ee,[e.picture&&e.picture.data&&e.picture.data.url?(s(),a("img",{key:0,src:e.picture.data.url,alt:e.name,class:"w-16 h-16 rounded-full"},null,8,te)):(s(),a("div",oe,n(e.name.charAt(0)),1)),t("div",se,[t("h3",ae,n(e.name),1),t("p",ne,"ID: "+n(e.id),1)]),i.value&&g(u).page_id===e.id?(s(),a("div",ie)):(s(),a("svg",re,r[2]||(r[2]=[t("path",{fill:"currentColor",d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"},null,-1)])))])],10,Y))),128))]),t("div",ce,[t("button",{onClick:r[0]||(r[0]=e=>o.window.close()),class:"text-blue-600 hover:text-blue-800"},n(o.$t("Cancel")),1)])])])])):(s(),F($,{key:0},{default:P(()=>[C(g(T),{title:l.title},null,8,["title"]),t("div",N,[t("div",O,[t("div",M,[t("h1",j,n(o.$t("Select Facebook Page")),1),t("p",B,n(o.$t("Choose which Facebook page you want to connect for posting")),1),t("div",E,[(s(!0),a(w,null,f(l.pages,e=>(s(),a("div",{key:e.id,class:_(["border-2 border-gray-200 rounded-lg p-4 hover:border-blue-500 transition cursor-pointer",{"opacity-50 cursor-not-allowed":i.value}]),onClick:d=>!i.value&&m(e.id)},[t("div",A,[e.picture&&e.picture.data&&e.picture.data.url?(s(),a("img",{key:0,src:e.picture.data.url,alt:e.name,class:"w-16 h-16 rounded-full"},null,8,q)):(s(),a("div",J,n(e.name.charAt(0)),1)),t("div",R,[t("h3",X,n(e.name),1),t("p",z,"ID: "+n(e.id),1)]),i.value&&g(u).page_id===e.id?(s(),a("div",D)):(s(),a("svg",H,r[1]||(r[1]=[t("path",{fill:"currentColor",d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"},null,-1)])))])],10,L))),128))]),t("div",I,[t("a",K,n(o.$t("Cancel")),1)])])])])]),_:1}))}};export{Oe as default};
