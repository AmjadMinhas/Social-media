import{r as i,m as Q,G as F,q as X,R as Y,f as Z,g as ee,T as E,O as v,H as te,o,a as e,n as c,c as l,b as m,t as n,w as T,ad as H,v as L,F as w,e as k,j as se,k as ae}from"./app-16024625.js";import{_ as oe}from"./App-82b4a0a3.js";import{P as le}from"./Pagination-342303f8.js";import"./Sidebar-76b95c07.js";import"./Menu-b6451fc0.js";import"./Modal-3ab14559.js";import"./ProfileModal-1a692e2d.js";import"./FormInput-5c26d6f8.js";import"./FormPhoneInput-71eed710.js";/* empty css                      */import"./FormSelect-fc4ff4e5.js";import"./index-cf21b94a.js";import"./hidden-769a48bc.js";import"./use-text-value-1db0facb.js";import"./transition-15823974.js";import"./micro-task-89dcd6af.js";import"./tabs-212a2a07.js";import"./LangToggle-fb2d22c0.js";import"./OrganizationModal-cb9ab2ac.js";import"./index-0725bf98.js";import"./MobileSidebar-6fe82e49.js";/* empty css              */import"./pusher-f995da32.js";import"./_plugin-vue_export-helper-c27b6911.js";const re={class:"md:flex md:flex-grow md:overflow-hidden"},ne={class:"p-4 border-b bg-white"},ie={class:"flex items-center justify-between mb-3"},de={class:"flex items-center gap-2"},ue=["title"],ce=["disabled"],pe={key:0},ve={key:1},me={class:"grid grid-cols-4 gap-2 mb-3"},ge={class:"text-center p-2 bg-green-50 rounded"},xe={class:"font-bold text-green-600"},fe={class:"text-center p-2 bg-blue-50 rounded"},ye={class:"font-bold text-blue-600"},be={class:"text-center p-2 bg-purple-50 rounded"},_e={class:"font-bold text-purple-600"},he={class:"text-center p-2 bg-sky-50 rounded"},we={class:"font-bold text-sky-600"},ke={class:"flex-1 overflow-y-auto"},Se={key:0},Ce=["onClick"],je={class:"flex items-center justify-between"},Me={class:"flex-1"},Te={class:"font-medium"},Pe={class:"text-xs text-gray-500 mt-1"},Be={key:0},Ie={key:1},Oe={class:"flex flex-col items-end"},Ue={class:"flex gap-1 mb-1"},Ve={class:"text-xs text-gray-400"},Ne={key:1,class:"p-4 text-center text-gray-500"},Ae={key:2,class:"p-4"},De={key:0,class:"p-4 bg-white border-b flex items-center justify-between"},Fe={class:"flex items-center space-x-3"},Ee={class:"font-semibold"},He={class:"text-xs text-gray-500"},Le={key:0},$e={class:"flex items-center gap-2 mb-1"},qe={class:"text-xs opacity-70"},ze={key:1,class:"text-center text-gray-500 mt-8"},Je={key:2,class:"p-4 bg-white border-t"},We=["value"],Ge=["disabled"],Re={key:0},Ke={key:1},Qe={key:3,class:"flex-1 flex items-center justify-center text-gray-500"},ht={__name:"Index",props:{contacts:{type:Object,default:()=>({data:[],links:[],current_page:1,last_page:1,per_page:20,total:0})},messages:{type:Object,default:null},selectedContact:{type:Object,default:null},filters:{type:Object,default:()=>({})},stats:{type:Object,default:()=>({whatsapp:0,facebook:0,instagram:0,twitter:0,total:0})},connectedPlatforms:{type:Array,default:()=>[]}},setup($){var A,D;const u=$,r=i(u.selectedContact||null),b=i(u.messages||null),d=i(u.contacts||{data:[],links:[],current_page:1,last_page:1,per_page:20,total:0}),_=i(u.stats||{whatsapp:0,facebook:0,instagram:0,twitter:0,total:0}),g=i(((A=u.filters)==null?void 0:A.search)||""),x=i(((D=u.filters)==null?void 0:D.platform)||""),f=i(""),y=i(""),h=i(!1),p=i(!1),S=i(null),C=i(null),P=i(null),q=Q(()=>d.value?{current_page:d.value.current_page||1,last_page:d.value.last_page||1,total:d.value.total||0}:{current_page:1,last_page:1,total:0}),j=a=>{if(!a||!a.chats)return[];const t=new Set;return a.chats.forEach(U=>{U.platform&&t.add(U.platform)}),Array.from(t)},B=a=>({whatsapp:"bg-green-100 text-green-700",facebook:"bg-blue-100 text-blue-700",instagram:"bg-purple-100 text-purple-700",twitter:"bg-sky-100 text-sky-700"})[a]||"bg-gray-100 text-gray-700",V=a=>{if(!a||!a.metadata)return"";try{const t=JSON.parse(a.metadata);return t.text&&t.text.body?t.text.body.substring(0,50):"Media message"}catch{return""}},z=a=>{if(!a||!a.metadata)return"";try{const t=JSON.parse(a.metadata);return t.text&&t.text.body?t.text.body:"Media message"}catch{return""}},I=a=>a?new Date(a).toLocaleString():"",J=a=>{r.value=a,v.get(`/social-inbox/${a.uuid}`,{platform:x.value,search:g.value},{preserveState:!0,preserveScroll:!0})},W=()=>{r.value=null,v.get("/social-inbox",{platform:x.value,search:g.value})},G=()=>{v.get("/social-inbox",{platform:x.value,search:g.value},{preserveState:!0})},R=()=>{v.get("/social-inbox",{platform:x.value,search:g.value},{preserveState:!0})},K=async()=>{if(!(!f.value||!y.value)){h.value=!0;try{E({contact_id:r.value.id,platform:f.value,message:y.value}).post("/social-inbox/send",{preserveScroll:!0,onSuccess:()=>{y.value="",v.reload({only:["messages"]})},onFinish:()=>{h.value=!1}})}catch(a){console.error("Error sending message:",a),h.value=!1}}},O=async(a=!1)=>{if(p.value){console.log("Sync already in progress, skipping...");return}p.value=!0;try{E({}).post("/social-inbox/sync",{preserveScroll:!0,onSuccess:()=>{P.value=new Date,a?v.reload({only:["contacts","messages","stats"],preserveState:!0,preserveScroll:!0}):v.reload()},onFinish:()=>{p.value=!1},onError:()=>{p.value=!1}})}catch(t){console.error("Error syncing messages:",t),p.value=!1}},N=()=>{te(()=>{S.value&&(S.value.scrollTop=S.value.scrollHeight)})};return F(()=>u.messages,a=>{b.value=a,N()}),F(()=>u.selectedContact,a=>{if(r.value=a,a){const t=j(a);t.length>0&&(f.value=t[0])}}),X(()=>{console.log("UnifiedSocialInbox mounted",{contacts:d.value,stats:_.value,selectedContact:r.value}),N(),C.value=setInterval(()=>{console.log("Auto-syncing messages..."),O(!0)},3e4),setTimeout(()=>{O(!0)},5e3)}),Y(()=>{C.value&&(clearInterval(C.value),C.value=null)}),(a,t)=>(o(),Z(oe,null,{default:ee(U=>[e("div",re,[e("div",{class:c(["md:w-[30%] md:flex flex-col h-full bg-white border-r border-l",r.value?"hidden md:hidden":""])},[e("div",ne,[e("div",ie,[e("div",de,[t[6]||(t[6]=e("h2",{class:"text-lg font-semibold"},"Unified Social Inbox",-1)),P.value?(o(),l("span",{key:0,class:"text-xs text-gray-500",title:"Last synced: "+I(P.value)},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"inline-block animate-spin"},[e("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})],-1)]),8,ue)):m("",!0)]),e("button",{onClick:t[0]||(t[0]=s=>O(!1)),disabled:p.value,class:"px-3 py-1.5 bg-blue-500 text-white rounded-md text-sm hover:bg-blue-600 disabled:opacity-50",title:"Auto-sync runs every 30 seconds"},[p.value?(o(),l("span",ve,"Syncing...")):(o(),l("span",pe,"Sync Now"))],8,ce)]),e("div",me,[e("div",ge,[t[7]||(t[7]=e("div",{class:"text-xs text-gray-600"},"WhatsApp",-1)),e("div",xe,n(_.value.whatsapp||0),1)]),e("div",fe,[t[8]||(t[8]=e("div",{class:"text-xs text-gray-600"},"Facebook",-1)),e("div",ye,n(_.value.facebook||0),1)]),e("div",be,[t[9]||(t[9]=e("div",{class:"text-xs text-gray-600"},"Instagram",-1)),e("div",_e,n(_.value.instagram||0),1)]),e("div",he,[t[10]||(t[10]=e("div",{class:"text-xs text-gray-600"},"Twitter",-1)),e("div",we,n(_.value.twitter||0),1)])]),T(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),onChange:G,class:"w-full px-3 py-2 border rounded-md text-sm mb-3"},t[11]||(t[11]=[e("option",{value:""},"All Platforms",-1),e("option",{value:"whatsapp"},"WhatsApp",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"instagram"},"Instagram",-1),e("option",{value:"twitter"},"Twitter",-1)]),544),[[H,x.value]]),T(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),onInput:R,placeholder:"Search contacts...",class:"w-full px-3 py-2 border rounded-md text-sm"},null,544),[[L,g.value]])]),e("div",ke,[d.value&&d.value.data&&d.value.data.length>0?(o(),l("div",Se,[(o(!0),l(w,null,k(d.value.data,s=>(o(),l("div",{key:s.id,onClick:M=>J(s),class:c(["p-3 border-b hover:bg-gray-50 cursor-pointer",r.value&&r.value.id===s.id?"bg-blue-50":""])},[e("div",je,[e("div",Me,[e("div",Te,n(s.full_name||s.first_name+" "+s.last_name||"Unknown"),1),e("div",Pe,[s.last_chat?(o(),l("span",Be,n(V(s.last_chat)),1)):s.lastChat?(o(),l("span",Ie,n(V(s.lastChat)),1)):m("",!0)])]),e("div",Oe,[e("div",Ue,[(o(!0),l(w,null,k(j(s),M=>(o(),l("span",{key:M,class:c([B(M),"text-xs px-2 py-0.5 rounded"])},n(M),3))),128))]),e("div",Ve,n(s.latest_chat_created_at?I(s.latest_chat_created_at):""),1)])])],10,Ce))),128))])):(o(),l("div",Ne,t[12]||(t[12]=[e("p",{class:"mb-2"},"No contacts found",-1),e("p",{class:"text-xs"},"Connect social accounts and sync messages to get started",-1)]))),d.value&&d.value.last_page>1?(o(),l("div",Ae,[se(le,{pagination:q.value},null,8,["pagination"])])):m("",!0)])],2),e("div",{class:c(["min-w-0 bg-cover flex flex-col chat-bg",r.value?"h-screen md:w-[70%]":"md:h-screen md:w-[70%]"])},[r.value?(o(),l("div",De,[e("div",Fe,[e("button",{onClick:W,class:"md:hidden p-2 hover:bg-gray-100 rounded"},t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 18l-6-6l6-6"})],-1)])),e("div",null,[e("div",Ee,n(r.value.full_name||"Unknown"),1),e("div",He,[(o(!0),l(w,null,k(j(r.value),s=>(o(),l("span",{key:s,class:c([B(s),"text-xs px-2 py-0.5 rounded mr-1"])},n(s),3))),128))])])])])):m("",!0),r.value&&b.value?(o(),l("div",{key:1,class:"flex-1 overflow-y-auto p-4",ref_key:"messagesContainer",ref:S},[b.value.data&&b.value.data.length>0?(o(),l("div",Le,[(o(!0),l(w,null,k(b.value.data,s=>(o(),l("div",{key:s.id,class:"mb-4"},[e("div",{class:c(["flex",s.type==="outbound"?"justify-end":"justify-start"])},[e("div",{class:c(["max-w-[70%] rounded-lg p-3",s.type==="outbound"?"bg-blue-500 text-white":"bg-white border"])},[e("div",$e,[e("span",{class:c([B(s.platform),"text-xs px-2 py-0.5 rounded"])},n(s.platform),3),e("span",qe,n(I(s.created_at)),1)]),e("div",null,n(z(s)),1)],2)],2)]))),128))])):(o(),l("div",ze," No messages yet "))],512)):m("",!0),r.value?(o(),l("div",Je,[e("form",{onSubmit:ae(K,["prevent"]),class:"flex gap-2"},[T(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),class:"px-3 py-2 border rounded-md text-sm",required:""},[t[14]||(t[14]=e("option",{value:""},"Select Platform",-1)),(o(!0),l(w,null,k(j(r.value),s=>(o(),l("option",{key:s,value:s},n(s),9,We))),128))],512),[[H,f.value]]),T(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>y.value=s),placeholder:"Type a message...",class:"flex-1 px-3 py-2 border rounded-md",required:""},null,512),[[L,y.value]]),e("button",{type:"submit",disabled:!f.value||!y.value||h.value,class:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50"},[h.value?(o(),l("span",Ke,"Sending...")):(o(),l("span",Re,"Send"))],8,Ge)],32)])):m("",!0),r.value?m("",!0):(o(),l("div",Qe,t[15]||(t[15]=[e("div",{class:"text-center"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",class:"mx-auto mb-4 opacity-50"},[e("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"})]),e("p",null,"Select a contact to view messages")],-1)])))],2)])]),_:1}))}};export{ht as default};
